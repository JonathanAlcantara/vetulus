sudo: required

language: cpp

services:
  - docker

before_install:
  - docker pull pantuza/vetulus:latest
  - docker run --rm -it -p 42500:42500 -p 42501:42501 --name vetulus -v $(pwd):/vetulus -d pantuza/vetulus:latest bash -c "cd scripts && ./run_stack_service.sh;"
  - docker exec -it vetulus bash -c "cd scripts && ./run_proto_service.sh;"

script:
  - docker exec -it vetulus bash -c "cd scripts && ./travis_build.sh;"
  - docker exec -it vetulus bash -c "cd scripts && ./test_stack_service.sh;"
  - docker exec -it vetulus bash -c "cd scripts && ./test_proto_service.sh;"

after_success:
  - docker exec -it --env COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN vetulus bash -c "coveralls --repo-token \$COVERALLS_REPO_TOKEN --include services/ --include manager/ --exclude-pattern '.*/build/' --gcov-options '\-lp'"
